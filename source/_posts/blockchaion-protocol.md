---
title: 区块链（二）：区块链的交易协议
date: 2023-02-18 20:24:26
published: false
tags:
categories:
- Blockchain
---

本节主要讲区块链的交易协议细节，即一笔交易是如何写入区块链的交易数据中的。

<!--more-->

## 去中心化的交易需要解决的问题

我们先看看中心化的交易是怎么样的。中心化的交易，货币是靠央行发行的，发行货币和发行多少货币一切都是它说的算，交易的清结算也是以它的账簿为准，任何交易数据只要写进它的账簿那么就是生效的。相比下，去中心化的交易系统因此有两个问题需要解决：

1、如何发行货币；

2、交易怎么进行才能做到可信。

因为是去中心化的，谁都可以有机会去更新区块链的数据，那么，货币发行怎么控制呢？同样，因为谁都可以有机会去写入交易数据，那么谁写入的数据才算是真实有效的呢？这些问题就需要区块链的交易协议去解决。

为了讲清楚交易协议，我们会提出一个个问题，然后看看区块链的去中心化交易协议是如何解决的。



### 区块链中的交易过程

抛开货币的发行问题，先看看交易是如何做到可信的，即一笔交易数据，如何保证双方都是出于真实意图的交易呢？

区块链两大加密技术之一就是公私钥，公私钥对就代表了一个区块链账户。其中公钥用于个人 ID 的标识，私钥用于签名，保证某一笔交易行为是这个人的意愿。我们举个例子，假设 A 需要转账给 B 和 C，那么交易记录就需要至少记录：

1、使用 A 的私钥签名交易数据，保证 A 的转账行为是 A 真实发起的。这个签名大家都认可，因为 A 的公钥是公开的，可以验证 A 的私钥签名；

2、交易记录中还需要 B 和 C 的公钥，因为此时想表达 B 和 C 这两个身份，就必须用他们的公钥，公钥此时就相当于区块链的身份 ID；

3、交易货币数量。

似乎以上数据就够了，但试想这样一个场景：

一个恶意用户，自己生成了公私钥对，告诉 B 和 C 说他是 A，那么，按照上面的三条数据要求，这个恶意用户是可以完全自己伪造出 A 转钱给 B 和 C 用户的。因此，这里就需要一些额外的信息，保证 B 和 C 是知道对方是不是 A。自然想到的是验证 A 的公钥，但 B 和 C 如何验证恶意用户出示的 A 的公钥是否真的是 A 的公钥呢？

这就需要上一节讲的区块链性质了——区块链上的信息都难以修改，因此是可信的。B 和 C 看到恶意用户出示 A 的公钥后，会去查区块链对应的公钥信息，即对应的余额，看是否有足够的钱支付本次转账，如果足够，那么这次交易就是安全的，这样，哪怕恶意用户不是 A，但他出示的公钥在区块链上的确有足够的余额，那就没问题。

因此，区块链只认公私钥对，只要交易时有足够的余额，那么交易就可以促成，是不是 A 也就无所谓了。

上面的文字，如果画成图形，那么看起来就是这样：

![交易时，需要校验身份和资金来源](https://www.jackhuang.cc/svg/blockchain-deal-verify.svg)

简单来说，就是每次交易，都需要能完成以下重要步骤：

1、出示付款发公钥和收款方的公钥；

2、付款方的公钥在区块链中能被找到；

3、在区块链中对应的付款方公钥下的余额足够支付本次交易；

4、付款方的公钥能验证交易签名。

校验通过后，交易信息将被写到区块中，如果此后 B 要转账给 D 和 E，那么同样也会进行上面的操作，画成图形，看起来像这这样：

![再一次交易](https://www.jackhuang.cc/svg/blockchain-deal-verify-another.svg)

由此可见，每一次交易，
